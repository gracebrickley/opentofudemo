# Atlantis Configuration
# Defines how Atlantis handles pull requests for this repository

version: 3

automerge: false
delete_source_branch_on_merge: false

# Parallel execution settings
parallel_plan: true
parallel_apply: false

# Project definitions
projects:
  # Platform: KIND Cluster
  - name: platform-kind-cluster
    dir: stacks/platform/kind-cluster
    workspace: default
    terraform_version: v1.8.8
    autoplan:
      when_modified:
        - "*.tf"
        - "*.hcl"
        - "terragrunt.hcl"
        - "../../../terragrunt.hcl"
      enabled: true
    apply_requirements:
      - approved
      - mergeable
    workflow: terragrunt
    
  # Platform: vcluster
  - name: platform-vcluster
    dir: stacks/platform/vcluster
    workspace: default
    terraform_version: v1.8.8
    autoplan:
      when_modified:
        - "*.tf"
        - "*.hcl"
        - "terragrunt.hcl"
        - "../../../terragrunt.hcl"
      enabled: true
    apply_requirements:
      - approved
      - mergeable
    workflow: terragrunt
    
  # Team A
  - name: teams-team-a
    dir: stacks/teams/team-a
    workspace: default
    terraform_version: v1.8.8
    autoplan:
      when_modified:
        - "*.tf"
        - "*.hcl"
        - "terragrunt.hcl"
        - "../../../terragrunt.hcl"
      enabled: true
    apply_requirements:
      - approved
      - mergeable
    workflow: terragrunt
    
  # Team B
  - name: teams-team-b
    dir: stacks/teams/team-b
    workspace: default
    terraform_version: v1.8.8
    autoplan:
      when_modified:
        - "*.tf"
        - "*.hcl"
        - "terragrunt.hcl"
        - "../../../terragrunt.hcl"
      enabled: true
    apply_requirements:
      - approved
      - mergeable
    workflow: terragrunt
